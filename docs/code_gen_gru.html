---

title: Loading Datasets


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/01_code_gen_gru.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_code_gen_gru.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Code-Generation-with-a-GRU">Code Generation with a GRU<a class="anchor-link" href="#Code-Generation-with-a-GRU"> </a></h3><p>&gt;</p>
<blockquote><p>@danaderp 09.16.20</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span> pip install sentencepiece
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Collecting sentencepiece
  Downloading sentencepiece-0.1.91-cp37-cp37m-manylinux1_x86_64.whl (1.1 MB)
     |████████████████████████████████| 1.1 MB 2.8 MB/s eta 0:00:01
Installing collected packages: sentencepiece
Successfully installed sentencepiece-0.1.91
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span> 
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">or_</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sentencepiece</span> <span class="k">as</span> <span class="nn">spm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">params</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;dummy_path&#39;</span> <span class="p">:</span> <span class="s1">&#39;../../data/dummy/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hyper&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;seq_length&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span>
            <span class="s1">&#39;buffer_size&#39;</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span>
            <span class="s1">&#39;rnn_units&#39;</span><span class="p">:</span><span class="mi">1024</span><span class="p">,</span>
            <span class="s1">&#39;epochs&#39;</span><span class="p">:</span><span class="mi">10</span>
        <span class="p">},</span>
        <span class="s1">&#39;checkpoint_dir&#39;</span><span class="p">:</span><span class="s1">&#39;../../data/checkpoint_dir/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dataset&#39;</span><span class="p">:</span><span class="s1">&#39;../../data/codesearchnet/clean_java_full.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bpe&#39;</span><span class="p">:</span><span class="s1">&#39;../../data/bpe/java_bpe_32k_c&#39;</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;seq_length&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>100</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;../../data/codesearchnet/clean_java_full.csv&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">java_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">java_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>code</th>
      <th>code_len</th>
      <th>code_tokens</th>
      <th>cyclomatic_complexity</th>
      <th>data_type</th>
      <th>method_name</th>
      <th>nloc</th>
      <th>parameter_count</th>
      <th>partition</th>
      <th>token_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>protected final void fastPathOrderedEmit(U val...</td>
      <td>134.0</td>
      <td>['protected', 'final', 'void', 'fastPathOrdere...</td>
      <td>7.0</td>
      <td>src</td>
      <td>fastPathOrderedEmit</td>
      <td>20.0</td>
      <td>3.0</td>
      <td>test</td>
      <td>131.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>@CheckReturnValue\n    @NonNull\n    @Schedule...</td>
      <td>63.0</td>
      <td>['@', 'CheckReturnValue', '@', 'NonNull', '@',...</td>
      <td>1.0</td>
      <td>src</td>
      <td>amb</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>test</td>
      <td>43.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>@SuppressWarnings("unchecked")\n    @CheckRetu...</td>
      <td>107.0</td>
      <td>['@', 'SuppressWarnings', '(', '"unchecked"', ...</td>
      <td>3.0</td>
      <td>src</td>
      <td>ambArray</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>test</td>
      <td>82.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>@SuppressWarnings({ "unchecked", "rawtypes" })...</td>
      <td>79.0</td>
      <td>['@', 'SuppressWarnings', '(', '{', '"unchecke...</td>
      <td>1.0</td>
      <td>src</td>
      <td>concat</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>test</td>
      <td>50.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>@SuppressWarnings({ "unchecked", "rawtypes" })...</td>
      <td>91.0</td>
      <td>['@', 'SuppressWarnings', '(', '{', '"unchecke...</td>
      <td>1.0</td>
      <td>src</td>
      <td>concat</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>test</td>
      <td>62.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">java_df</span><span class="p">[</span><span class="n">java_df</span><span class="p">[</span><span class="s1">&#39;partition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">java_df</span><span class="p">[</span><span class="n">java_df</span><span class="p">[</span><span class="s1">&#39;partition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">]</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">java_df</span><span class="p">[</span><span class="n">java_df</span><span class="p">[</span><span class="s1">&#39;partition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_prefix</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bpe&#39;</span><span class="p">]</span>
<span class="n">sp_bpe</span> <span class="o">=</span> <span class="n">spm</span><span class="o">.</span><span class="n">SentencePieceProcessor</span><span class="p">()</span>
<span class="n">sp_bpe</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">m_prefix</span> <span class="o">+</span><span class="s1">&#39;.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sp_bpe</span><span class="o">.</span><span class="n">encode_as_pieces</span><span class="p">(</span><span class="s1">&#39;private Hi_Altituted(float j = 00; j++)&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp_bpe</span><span class="o">.</span><span class="n">encode_as_ids</span><span class="p">(</span><span class="s1">&#39;private Hi_Altituted(float j = 00; j++)&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;▁private&#39;, &#39;▁H&#39;, &#39;i&#39;, &#39;_&#39;, &#39;Alt&#39;, &#39;it&#39;, &#39;uted&#39;, &#39;(&#39;, &#39;float&#39;, &#39;▁j&#39;, &#39;▁=&#39;, &#39;▁0&#39;, &#39;0;&#39;, &#39;▁j&#39;, &#39;++)&#39;]
[416, 480, 31899, 31940, 8821, 38, 7784, 31906, 2416, 331, 16, 165, 1483, 331, 672]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_train</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>26900     protected final void bindIndexed(Configuration...
26901     public void setServletRegistrationBeans(\n\t\t...
26902     public void addServletRegistrationBeans(\n\t\t...
26903     public void setServletNames(Collection&lt;String&gt;...
26904     public void addServletNames(String... servletN...
                                ...                        
481168    public void upgrade() {\n        ByteArrayOutp...
481169    protected static EnvVars getEnvVars(Run run, T...
481170    protected static void insertLabels(CreateConta...
481171    public void setEnabled(boolean enabled) {\n   ...
481172    @Nonnull\n    @Override\n    public NodeProvis...
Name: code, Length: 454273, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#TODO Save this data somewhere!</span>
<span class="n">code_train_bpe</span> <span class="o">=</span> <span class="p">[</span> <span class="n">sp_bpe</span><span class="o">.</span><span class="n">encode_as_ids</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">code_train</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;bpe_ids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_train_bpe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  &#34;&#34;&#34;Entry point for launching an IPython kernel.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_subwords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">mtd</span><span class="p">)</span> <span class="k">for</span> <span class="n">mtd</span> <span class="ow">in</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;bpe_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;count_subwords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_subwords</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  &#34;&#34;&#34;Entry point for launching an IPython kernel.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>code_len</th>
      <th>code_tokens</th>
      <th>cyclomatic_complexity</th>
      <th>data_type</th>
      <th>method_name</th>
      <th>nloc</th>
      <th>parameter_count</th>
      <th>partition</th>
      <th>token_count</th>
      <th>bpe_ids</th>
      <th>count_subwords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26900</th>
      <td>0</td>
      <td>80.0</td>
      <td>['protected', 'final', 'void', 'bindIndexed', ...</td>
      <td>4.0</td>
      <td>src</td>
      <td>bindIndexed</td>
      <td>11.0</td>
      <td>6.0</td>
      <td>train</td>
      <td>75.0</td>
      <td>[731, 157, 211, 4262, 9890, 31906, 866, 22716,...</td>
      <td>92</td>
    </tr>
    <tr>
      <th>26901</th>
      <td>1</td>
      <td>37.0</td>
      <td>['public', 'void', 'setServletRegistrationBean...</td>
      <td>1.0</td>
      <td>src</td>
      <td>setServletRegistrationBeans</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>train</td>
      <td>34.0</td>
      <td>[103, 211, 372, 1339, 5320, 4152, 31906, 1209,...</td>
      <td>49</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="EDA">EDA<a class="anchor-link" href="#EDA"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>code_len</th>
      <th>cyclomatic_complexity</th>
      <th>nloc</th>
      <th>parameter_count</th>
      <th>token_count</th>
      <th>count_subwords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>454273.000000</td>
      <td>454273.000000</td>
      <td>454273.000000</td>
      <td>454273.000000</td>
      <td>454273.000000</td>
      <td>454273.000000</td>
      <td>454273.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14874.408877</td>
      <td>112.688527</td>
      <td>3.803334</td>
      <td>14.980697</td>
      <td>1.631616</td>
      <td>107.098163</td>
      <td>145.445378</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8710.470899</td>
      <td>233.378681</td>
      <td>13.074112</td>
      <td>32.522032</td>
      <td>1.390295</td>
      <td>226.699784</td>
      <td>376.794328</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>20.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>7.000000</td>
      <td>20.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>7276.000000</td>
      <td>42.000000</td>
      <td>1.000000</td>
      <td>6.000000</td>
      <td>1.000000</td>
      <td>38.000000</td>
      <td>50.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>14851.000000</td>
      <td>66.000000</td>
      <td>2.000000</td>
      <td>9.000000</td>
      <td>1.000000</td>
      <td>62.000000</td>
      <td>80.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>22426.000000</td>
      <td>121.000000</td>
      <td>4.000000</td>
      <td>16.000000</td>
      <td>2.000000</td>
      <td>116.000000</td>
      <td>149.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>29999.000000</td>
      <td>68278.000000</td>
      <td>4434.000000</td>
      <td>11325.000000</td>
      <td>54.000000</td>
      <td>68274.000000</td>
      <td>113356.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">median_absolute_deviation</span><span class="p">(</span><span class="n">count_subwords</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>54.856199999999994</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_tokens</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">code_tokens</span><span class="o">.</span><span class="n">values</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_vocab_tokens</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">eval</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>  <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">train_tokens</span> <span class="p">]</span> <span class="c1">#Evaluating given tokens</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_counter_tokens</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Counter</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">train_vocab_tokens</span> <span class="p">]</span> <span class="c1">#Counting the words</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_counter</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">train_counter_tokens</span> <span class="p">)</span> <span class="c1">## [Warning! Time Consuming]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chars</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">chars</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">])</span> <span class="c1">#tst</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;aa&#39;, &#39;p&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab_tokens</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">or_</span> <span class="p">,</span> <span class="n">vocab_tokens</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">vocab_tokens</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">MAX_SEQ</span> <span class="o">=</span> <span class="mi">250</span> <span class="c1">## Max sequence of subwords</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;count_subwords&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">MAX_SEQ</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;count_subwords&#39;</span><span class="p">,</span> <span class="s1">&#39;code_len&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f852deb0890&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f852de50d10&gt;]],
      dtype=object)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sp_bpe</span><span class="o">.</span><span class="n">encode_as_ids</span><span class="p">(</span><span class="s1">&#39;Hola lol&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[480, 96, 31900, 255, 31903]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">code_train_bpe</span><span class="p">[</span><span class="mi">400</span><span class="p">][:</span><span class="mi">68</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>68</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_train_bpe</span> <span class="o">=</span> <span class="p">[</span><span class="n">subword</span><span class="p">[:</span><span class="n">MAX_SEQ</span><span class="p">]</span> <span class="k">for</span> <span class="n">subword</span> <span class="ow">in</span> <span class="n">df_train</span><span class="o">.</span><span class="n">bpe_ids</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="c1">#Trimming Until Threshold </span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_train_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">code_train_bpe</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path_to_file</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;dummy_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;shakespeare.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;https://storage.googleapis.com/download.tensorflow.org/data/shakespeare.txt&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading data from https://storage.googleapis.com/download.tensorflow.org/data/shakespeare.txt
1122304/1115394 [==============================] - 0s 0us/step
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="c1"># length of text is the number of characters in it</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Length of text: </span><span class="si">{}</span><span class="s1"> characters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Length of text: 1115394 characters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="mi">250</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>First Citizen:
Before we proceed any further, hear me speak.

All:
Speak, speak.

First Citizen:
You are all resolved rather to die than to famish?

All:
Resolved. resolved.

First Citizen:
First, you know Caius Marcius is chief enemy to the people.

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> unique characters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>65 unique characters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vectorize-the-text">Vectorize the text<a class="anchor-link" href="#Vectorize-the-text"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">char2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">u</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span>
<span class="n">idx2char</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>

<span class="n">text_as_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">char2idx</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">char</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">char2idx</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{:4s}</span><span class="s1">: </span><span class="si">{:3d}</span><span class="s1">,&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">char</span><span class="p">),</span> <span class="n">char2idx</span><span class="p">[</span><span class="n">char</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ...</span><span class="se">\n</span><span class="s1">}&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  &#39;\n&#39;:   0,
  &#39; &#39; :   1,
  &#39;!&#39; :   2,
  &#39;$&#39; :   3,
  &#39;&amp;&#39; :   4,
  &#34;&#39;&#34; :   5,
  &#39;,&#39; :   6,
  &#39;-&#39; :   7,
  &#39;.&#39; :   8,
  &#39;3&#39; :   9,
  &#39;:&#39; :  10,
  &#39;;&#39; :  11,
  &#39;?&#39; :  12,
  &#39;A&#39; :  13,
  &#39;B&#39; :  14,
  &#39;C&#39; :  15,
  &#39;D&#39; :  16,
  &#39;E&#39; :  17,
  &#39;F&#39; :  18,
  &#39;G&#39; :  19,
  ...
}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> ---- characters mapped to int ---- &gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="mi">13</span><span class="p">]),</span> <span class="n">text_as_int</span><span class="p">[:</span><span class="mi">13</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;First Citizen&#39; ---- characters mapped to int ---- &gt; [18 47 56 57 58  1 15 47 58 47 64 43 52]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-prediction-task">The prediction task<a class="anchor-link" href="#The-prediction-task"> </a></h3><p>Given a character, or a sequence of characters, what is the most probable next character? This is the task we're training the model to perform. The input to the model will be a sequence of characters, and we train the model to predict the output—the following character at each time step.</p>
<p>Since RNNs maintain an internal state that depends on the previously seen elements, given all the characters computed until this moment, what is the next character?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq_length</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;seq_length&#39;</span><span class="p">]</span>
<span class="n">examples_per_epoch</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="n">seq_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">char_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">text_as_int</span><span class="p">)</span> <span class="c1">#subs char_dataset for subword</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">char_dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">numpy</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>F
i
r
s
t
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sequences</span> <span class="o">=</span> <span class="n">char_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">seq_length</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">numpy</span><span class="p">()])))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;First Citizen:\nBefore we proceed any further, hear me speak.\n\nAll:\nSpeak, speak.\n\nFirst Citizen:\nYou &#39;
&#39;are all resolved rather to die than to famish?\n\nAll:\nResolved. resolved.\n\nFirst Citizen:\nFirst, you k&#39;
&#34;now Caius Marcius is chief enemy to the people.\n\nAll:\nWe know&#39;t, we know&#39;t.\n\nFirst Citizen:\nLet us ki&#34;
&#34;ll him, and we&#39;ll have corn at our own price.\nIs&#39;t a verdict?\n\nAll:\nNo more talking on&#39;t; let it be d&#34;
&#39;one: away, away!\n\nSecond Citizen:\nOne word, good citizens.\n\nFirst Citizen:\nWe are accounted poor citi&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">split_input_target</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
    <span class="n">input_text</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">target_text</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">input_text</span><span class="p">,</span> <span class="n">target_text</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">split_input_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">input_example</span><span class="p">,</span> <span class="n">target_example</span> <span class="ow">in</span>  <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Input data: &#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">input_example</span><span class="o">.</span><span class="n">numpy</span><span class="p">()])))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Target data:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">target_example</span><span class="o">.</span><span class="n">numpy</span><span class="p">()])))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input data:  &#39;First Citizen:\nBefore we proceed any further, hear me speak.\n\nAll:\nSpeak, speak.\n\nFirst Citizen:\nYou&#39;
Target data: &#39;irst Citizen:\nBefore we proceed any further, hear me speak.\n\nAll:\nSpeak, speak.\n\nFirst Citizen:\nYou &#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#At the next timestep, it does the same thing but the RNN considers the previous step context in addition to the current input character.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">input_idx</span><span class="p">,</span> <span class="n">target_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">input_example</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">target_example</span><span class="p">[:</span><span class="mi">5</span><span class="p">])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step </span><span class="si">{:4d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  input: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{:s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_idx</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">input_idx</span><span class="p">])))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  expected output: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{:s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_idx</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">target_idx</span><span class="p">])))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Step    0
  input: 18 (&#39;F&#39;)
  expected output: 47 (&#39;i&#39;)
Step    1
  input: 47 (&#39;i&#39;)
  expected output: 56 (&#39;r&#39;)
Step    2
  input: 56 (&#39;r&#39;)
  expected output: 57 (&#39;s&#39;)
Step    3
  input: 57 (&#39;s&#39;)
  expected output: 58 (&#39;t&#39;)
Step    4
  input: 58 (&#39;t&#39;)
  expected output: 1 (&#39; &#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-training-batches">Create training batches<a class="anchor-link" href="#Create-training-batches"> </a></h3><p>Buffer size to shuffle the dataset
(TF data is designed to work with possibly infinite sequences,
so it doesn't attempt to shuffle the entire sequence in memory. Instead,
it maintains a buffer in which it shuffles elements).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span> <span class="c1"># Batch size</span>
<span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;buffer_size&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;BatchDataset shapes: ((64, 100), (64, 100)), types: (tf.int64, tf.int64)&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Building-the-model">Building the model<a class="anchor-link" href="#Building-the-model"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>

<span class="c1"># The embedding dimension</span>
<span class="n">embedding_dim</span> <span class="o">=</span> <span class="mi">256</span> <span class="c1">##&lt;----------[Hyperparams]</span>

<span class="c1"># Number of RNN units</span>
<span class="n">rnn_units</span> <span class="o">=</span>  <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;rnn_units&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">rnn_units</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span>
                              <span class="n">batch_input_shape</span><span class="o">=</span><span class="p">[</span><span class="n">batch_size</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span>
                        <span class="n">rnn_units</span><span class="p">,</span>
                        <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">stateful</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">recurrent_initializer</span><span class="o">=</span><span class="s1">&#39;glorot_uniform&#39;</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For each character the model looks up the embedding, runs the GRU one timestep with the embedding as input, and applies the dense layer to generate logits predicting the log-likelihood of the next character:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span>
    <span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span>
    <span class="n">embedding_dim</span><span class="o">=</span><span class="n">embedding_dim</span><span class="p">,</span>
    <span class="n">rnn_units</span><span class="o">=</span><span class="n">rnn_units</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Running-the-model">Running the model<a class="anchor-link" href="#Running-the-model"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">input_example_batch</span><span class="p">,</span> <span class="n">target_example_batch</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">example_batch_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_example_batch</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">example_batch_predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;# (batch_size, sequence_length, vocab_size)&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(64, 100, 65) # (batch_size, sequence_length, vocab_size)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the above example the sequence length of the input is 100 but the model can be run on inputs of any length:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Model: &#34;sequential&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding (Embedding)        (64, None, 256)           16640     
_________________________________________________________________
gru (GRU)                    (64, None, 1024)          3938304   
_________________________________________________________________
dense (Dense)                (64, None, 65)            66625     
=================================================================
Total params: 4,021,569
Trainable params: 4,021,569
Non-trainable params: 0
_________________________________________________________________
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampled_indices</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">categorical</span><span class="p">(</span><span class="n">example_batch_predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sampled_indices</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">sampled_indices</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampled_indices</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([30,  2, 28, 43, 32,  6, 15, 39, 10, 62,  5, 52, 47, 28, 35, 37, 48,
       36, 37, 64, 13,  8, 18, 15, 33, 47, 23, 21, 13,  7, 49, 43, 34, 63,
       23, 62, 55, 62, 41, 25, 40,  6, 50, 19, 12, 23, 34,  6, 51, 55,  6,
       20, 21,  7, 17, 30, 42, 28, 57,  3, 18,  8,  0, 34, 40, 59, 42, 25,
        4,  7, 59, 54, 15, 49,  7, 62, 34, 58,  1, 51, 25,  3, 18, 18,  0,
        5,  9, 25,  5, 14, 64,  8, 62, 57, 28,  4, 44,  9,  1, 15])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Decode these to see the text predicted by this untrained model:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">input_example_batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Next Char Predictions: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">sampled_indices</span> <span class="p">])))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Input: 
 &#34;ountenances.\n\nSICINIUS:\n&#39;Tis this slave;--\nGo whip him, &#39;fore the people&#39;s eyes:--his raising;\nNothi&#34;

Next Char Predictions: 
 &#34;R!PeT,Ca:x&#39;niPWYjXYzA.FCUiKIA-keVyKxqxcMb,lG?KV,mq,HI-ERdPs$F.\nVbudM&amp;-upCk-xVt mM$FF\n&#39;3M&#39;Bz.xsP&amp;f3 C&#34;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Training-The-model">Training The model<a class="anchor-link" href="#Training-The-model"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">logits</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">sparse_categorical_crossentropy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">logits</span><span class="p">,</span> <span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_batch_loss</span>  <span class="o">=</span> <span class="n">loss</span><span class="p">(</span><span class="n">target_example_batch</span><span class="p">,</span> <span class="n">example_batch_predictions</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction shape: &quot;</span><span class="p">,</span> <span class="n">example_batch_predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot; # (batch_size, sequence_length, vocab_size)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;scalar_loss:      &quot;</span><span class="p">,</span> <span class="n">example_batch_loss</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Prediction shape:  (64, 100, 65)  # (batch_size, sequence_length, vocab_size)
scalar_loss:       4.173104
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Configure-checkpoints">Configure checkpoints<a class="anchor-link" href="#Configure-checkpoints"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;checkpoint_dir&#39;</span><span class="p">]</span>
<span class="c1"># Name of the checkpoint files</span>
<span class="n">checkpoint_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span> <span class="s2">&quot;ckpt_</span><span class="si">{epoch}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">checkpoint_callback</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span>
    <span class="n">filepath</span><span class="o">=</span><span class="n">checkpoint_prefix</span><span class="p">,</span>
    <span class="n">save_weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Execute-Training">Execute Training<a class="anchor-link" href="#Execute-Training"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hyper&#39;</span><span class="p">][</span><span class="s1">&#39;epochs&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">checkpoint_callback</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Epoch 1/10
172/172 [==============================] - 243s 1s/step - loss: 2.6501
Epoch 2/10
172/172 [==============================] - 246s 1s/step - loss: 1.9590
Epoch 3/10
172/172 [==============================] - 247s 1s/step - loss: 1.6893
Epoch 4/10
172/172 [==============================] - 245s 1s/step - loss: 1.5404
Epoch 5/10
172/172 [==============================] - 247s 1s/step - loss: 1.4535
Epoch 6/10
172/172 [==============================] - 246s 1s/step - loss: 1.3947
Epoch 7/10
172/172 [==============================] - 244s 1s/step - loss: 1.3486
Epoch 8/10
172/172 [==============================] - 247s 1s/step - loss: 1.3115
Epoch 9/10
172/172 [==============================] - 248s 1s/step - loss: 1.2756
Epoch 10/10
172/172 [==============================] - 245s 1s/step - loss: 1.2439
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Generating-Sequences">Generating Sequences<a class="anchor-link" href="#Generating-Sequences"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;../../data/checkpoint_dir/ckpt_10&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To run the model with a different batch_size, we need to rebuild the model and restore the weights from the checkpoint.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">rnn_units</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Rebuilding the model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;tensorflow.python.training.tracking.util.CheckpointLoadStatus at 0x7f85e1408cd0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Model: &#34;sequential_1&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding_1 (Embedding)      (1, None, 256)            16640     
_________________________________________________________________
gru_1 (GRU)                  (1, None, 1024)           3938304   
_________________________________________________________________
dense_1 (Dense)              (1, None, 65)             66625     
=================================================================
Total params: 4,021,569
Trainable params: 4,021,569
Non-trainable params: 0
_________________________________________________________________
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generate_text</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">start_string</span><span class="p">):</span>
    <span class="c1"># Evaluation step (generating text using the learned model)</span>

    <span class="c1"># Number of characters to generate</span>
    <span class="n">num_generate</span> <span class="o">=</span> <span class="mi">1000</span>

    <span class="c1"># Converting our start string to numbers (vectorizing)</span>
    <span class="n">input_eval</span> <span class="o">=</span> <span class="p">[</span><span class="n">char2idx</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start_string</span><span class="p">]</span>
    <span class="n">input_eval</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">input_eval</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Empty string to store our results</span>
    <span class="n">text_generated</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Low temperatures results in more predictable text.</span>
    <span class="c1"># Higher temperatures results in more surprising text.</span>
    <span class="c1"># Experiment to find the best setting.</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Here batch size == 1</span>
    <span class="n">model</span><span class="o">.</span><span class="n">reset_states</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_generate</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_eval</span><span class="p">)</span>
        <span class="c1"># remove the batch dimension</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># using a categorical distribution to predict the character returned by the model</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span> <span class="o">/</span> <span class="n">temperature</span>
        <span class="n">predicted_id</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">categorical</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="c1"># We pass the predicted character as the next input to the model</span>
        <span class="c1"># along with the previous hidden state</span>
        <span class="n">input_eval</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="n">predicted_id</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">text_generated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx2char</span><span class="p">[</span><span class="n">predicted_id</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">start_string</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_generated</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">generate_text</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">start_string</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;ROMEO: &quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ROMEO: the unsuit of state
To puy him beholding these sentin the eye sweet,
For then thus take my wrong im of a tunning nose,
My poor enty busy; but they will rush not Laurely looks!
Since at hand, my lord, this way I mean goo last,
But citcuse better my pack in heaven;
&#39;Tis way done tell your good stilk,
Which whom he be post, upon theur grief as I no done.

JOHN OF GAUNT:
O, let the lick, the other&#39;s nyed with
Birothop-gots: tickless he are mine opinion.

AEdile:
Perchance believed: it is no noble.

ISABELLA:
O Romeo? a son, for Imendeed my sour!

LADY CAPULET:
A match&#39;d at me, the mountain arms.

First Killan:
Within this friend trad it in your foe.

KATHARINA:
For tears, and single him of my promise to marry.

BENVOLIO:
Think you, sir, I am pluck&#39;d to see ye
Angel rather hang of honour,
I will that it had rather so awated,
Never-woour master of what much struck swixts for his past
And serely&#39;t now a pair of my success,
hy loss returns than your death, pirght be round to her;
And so I bid 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">The</span><span class="o">&lt;</span>\<span class="n">s</span><span class="o">&gt;&lt;</span>\<span class="n">s</span><span class="o">&gt;</span><span class="n">excelent</span><span class="o">&lt;</span>\<span class="n">s</span><span class="o">&gt;</span><span class="n">pipeline</span> <span class="o">&lt;</span>\<span class="n">n</span><span class="o">&gt;</span>\<span class="n">n</span>
<span class="o">&lt;</span>\<span class="n">t</span><span class="o">&gt;&lt;</span>\<span class="n">t</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">exc</span> <span class="n">pop</span> <span class="o">&lt;</span>\<span class="n">n</span><span class="o">&gt;</span>\<span class="n">n</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

