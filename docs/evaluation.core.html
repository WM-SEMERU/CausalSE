---

title: Evaluation


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/04_evaluation.core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_evaluation.core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_fake</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>aaaa(bb(aaaa(bb()()ccc)dd)()ccc)dd</td>
    </tr>
    <tr>
      <th>1</th>
      <td>aaaa(bb()ccccc)dd</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mean_probs" class="doc_header"><code>get_mean_probs</code><a href="https://github.com/ArtificialSoftwareEngineering/icodegen/tree/main/icodegen/evaluation/core.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mean_probs</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>model</code></strong>:<a href="/icodegen/model.core.html#Model"><code>Model</code></a>, <strong><code>n</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Get the mean probability of each token that the model
should predict for an entire pandas dataframe.</p>
<p>:param df: the pandas dataframe containing each method to have the model predict on
:param model: the model used to generate the predictions
:param n: the number of methods to evaluate. If none, the entire dataframe will be used
:returns: returns a numpy array of the mean probability for each token in the model's vocab</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NON_NAN_PROBS_MEAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mf">2.01237513e-05</span><span class="p">,</span>
        <span class="mf">1.98944481e-05</span><span class="p">,</span>
        <span class="mf">2.01449202e-05</span><span class="p">,</span>
        <span class="mf">2.04353437e-05</span><span class="p">,</span>
        <span class="mf">2.02043060e-05</span><span class="p">,</span>
        <span class="mf">2.02826177e-05</span><span class="p">,</span>
        <span class="mf">2.09888076e-05</span><span class="p">,</span>
        <span class="mf">2.07051467e-05</span><span class="p">,</span>
        <span class="mf">1.98100976e-05</span><span class="p">,</span>
        <span class="mf">2.02152678e-05</span><span class="p">,</span>
        <span class="mf">2.02035244e-05</span><span class="p">,</span>
        <span class="mf">2.10283021e-05</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">mean_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_mean_probs</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">trnsfr_model</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">non_nan_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean_probs</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">non_nan_mean_prob</span> <span class="o">=</span> <span class="n">mean_probs</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">non_nan_mean_prob</span><span class="p">,</span> <span class="n">NON_NAN_PROBS_MEAN</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NON_NAN_PROBS_MEAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mf">1.99270412e-05</span><span class="p">,</span>
        <span class="mf">1.99168703e-05</span><span class="p">,</span>
        <span class="mf">1.98815596e-05</span><span class="p">,</span>
        <span class="mf">1.99057849e-05</span><span class="p">,</span>
        <span class="mf">1.98800869e-05</span><span class="p">,</span>
        <span class="mf">1.98893995e-05</span><span class="p">,</span>
        <span class="mf">1.98797388e-05</span><span class="p">,</span>
        <span class="mf">1.98960342e-05</span><span class="p">,</span>
        <span class="mf">1.99086674e-05</span><span class="p">,</span>
        <span class="mf">1.98605580e-05</span><span class="p">,</span>
        <span class="mf">1.98807957e-05</span><span class="p">,</span>
        <span class="mf">1.98842057e-05</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">mean_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_mean_probs</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">gru_model</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">non_nan_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean_probs</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">non_nan_mean_prob</span> <span class="o">=</span> <span class="n">mean_probs</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">non_nan_mean_prob</span><span class="p">,</span> <span class="n">NON_NAN_PROBS_MEAN</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_parens" class="doc_header"><code>find_parens</code><a href="https://github.com/ArtificialSoftwareEngineering/icodegen/tree/main/icodegen/evaluation/core.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_parens</code>(<strong><code>toks</code></strong>:<code>List</code>[<code>str</code>], <strong><code>opening</code></strong>:<code>str</code>, <strong><code>closing</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Get the indices for the opening and closing tokens.
From <a href="https://stackoverflow.com/a/29992065/5768407">https://stackoverflow.com/a/29992065/5768407</a>
by user Baltasarq (<a href="https://stackoverflow.com/users/266978/baltasarq">https://stackoverflow.com/users/266978/baltasarq</a>).</p>
<p>:param toks: the tokenized version of a method
:param opening: the opening token that will be matched against the closing token
:param closing: the closing token that will be matched against the opening token
:returns: returns a dictionary with the opening token indices as the keys and the closing token indices as the values</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mean_dist_probs" class="doc_header"><code>mean_dist_probs</code><a href="https://github.com/ArtificialSoftwareEngineering/icodegen/tree/main/icodegen/evaluation/core.py#L127" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mean_dist_probs</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>model</code></strong>:<a href="/icodegen/model.core.html#Model"><code>Model</code></a>, <strong><code>opening</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>'&lt;{&gt;'</code></em>, <strong><code>closing</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>'&lt;}&gt;'</code></em>, <strong><code>n</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Get the distance between opening and closing tokens and the mean probability of each closing token that the model should predict for an entire pandas dataframe.</p>
<p>:param df: the pandas dataframe containing each method to have the model predict on
:param model: the model used to generate the predictions
:param opening: the opening token used for calculating the distance between opening and closing tokens
:param closing: the closing token used for calculating the distance between opening and closing tokens as well as the token to get the mean probability of
:param n: the number of methods to evaluate. If none, the entire dataframe will be used
:returns: returns a dataframe with the distances between opening and closing tokens and their mean probabilities</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIST_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
        <span class="s2">&quot;mean_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">1.98822217e-05</span><span class="p">,</span>
            <span class="mf">1.97613608e-05</span><span class="p">,</span>
            <span class="mf">1.97816771e-05</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;std_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">4.93400876e-09</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;med_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">2.04683793e-05</span><span class="p">,</span>
            <span class="mf">2.07205376e-05</span><span class="p">,</span>
            <span class="mf">1.97817026e-05</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;mad_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">4.93400876e-09</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df_dist</span> <span class="o">=</span> <span class="n">mean_dist_probs</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">gru_model</span><span class="p">,</span> <span class="n">opening</span><span class="o">=</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">closing</span><span class="o">=</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">mean_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">mean_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">std_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">std_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">med_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">med_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">mad_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">mad_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIST_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
        <span class="s2">&quot;mean_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">1.98822217e-05</span><span class="p">,</span>
            <span class="mf">1.97613608e-05</span><span class="p">,</span>
            <span class="mf">1.97816771e-05</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;std_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">4.93400876e-09</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;med_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">2.04683793e-05</span><span class="p">,</span>
            <span class="mf">2.07205376e-05</span><span class="p">,</span>
            <span class="mf">1.97817026e-05</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;mad_prob&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">4.93400876e-09</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
            <span class="mf">0.00000000e00</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df_dist</span> <span class="o">=</span> <span class="n">mean_dist_probs</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">trnsfr_model</span><span class="p">,</span> <span class="n">opening</span><span class="o">=</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">closing</span><span class="o">=</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">mean_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">mean_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">std_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">std_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">med_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">med_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">DIST_DF</span><span class="o">.</span><span class="n">mad_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_dist</span><span class="o">.</span><span class="n">mad_prob</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># TODO: make this binning process easier where I can just pass in some vars and it handles it for me</span>
<span class="c1"># df_dist[&quot;bin&quot;] = pd.cut(</span>
<span class="c1">#     df_dist.dist, bins=[0, 10, 20], labels=[&quot;0-10&quot;, &quot;11-20&quot;], include_lowest=True</span>
<span class="c1"># )</span>
<span class="c1"># df_dist = df_dist.sort_values(&quot;dist&quot;)</span>

<span class="c1"># bars = {}</span>
<span class="c1"># for x in df_dist.bin.unique():</span>
<span class="c1">#     bars[x] = sum(df_dist.loc[df_dist.bin == x].mean_prob.values)</span>

<span class="c1"># plt.bar(bars.keys(), bars.values())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mean_cross_entropy" class="doc_header"><code>get_mean_cross_entropy</code><a href="https://github.com/ArtificialSoftwareEngineering/icodegen/tree/main/icodegen/evaluation/core.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mean_cross_entropy</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>model</code></strong>:<a href="/icodegen/model.core.html#Model"><code>Model</code></a>, <strong><code>n</code></strong>:<code>Optional</code>[<code>int</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Get the mean cross entropy for a model on an entire pandas dataframe</p>
<p>:param df: the pandas dataframe containing each method to have the model predict on
:param model: the model used to generate the predictions
:param n: the number of methods to evaluate. If none, the entire dataframe will be used
:returns: returns the mean cross entropy of the models predictions compared to true labels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cross_entropy_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">mthd</span> <span class="ow">in</span> <span class="n">df_fake</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">gru_model</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">mthd</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">gru_model</span><span class="o">.</span><span class="n">get_probs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">losses</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">sparse_categorical_crossentropy</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">],</span> <span class="n">probs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">cross_entropy_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>

<span class="n">CROSS_ENTROPY_MEAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_MEDIAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_STD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_MAD</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">median_abs_deviation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">cross_entropy</span> <span class="o">=</span> <span class="n">get_mean_cross_entropy</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">gru_model</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MEAN</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MEDIAN</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_STD</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MAD</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;mad&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cross_entropy_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">mthd</span> <span class="ow">in</span> <span class="n">df_fake</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">trnsfr_model</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">mthd</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">trnsfr_model</span><span class="o">.</span><span class="n">get_probs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">losses</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">sparse_categorical_crossentropy</span><span class="p">(</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">],</span> <span class="n">probs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">cross_entropy_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>

<span class="n">CROSS_ENTROPY_MEAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_MEDIAN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_STD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">CROSS_ENTROPY_MAD</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">median_abs_deviation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cross_entropy_losses</span><span class="p">))</span>
<span class="n">cross_entropy</span> <span class="o">=</span> <span class="n">get_mean_cross_entropy</span><span class="p">(</span><span class="n">df_fake</span><span class="p">,</span> <span class="n">trnsfr_model</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MEAN</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MEDIAN</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_STD</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">CROSS_ENTROPY_MAD</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">[</span><span class="s2">&quot;mad&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate" class="doc_header"><code>evaluate</code><a href="https://github.com/ArtificialSoftwareEngineering/icodegen/tree/main/icodegen/evaluation/core.py#L310" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate</code>(<strong><code>data_path</code></strong>, <strong><code>model_path</code></strong>)</p>
</blockquote>
<p>Function for evaluating models related to the library.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

